<html><head><script type='text/javascript' src='jquery-latest.js'></script><link rel='stylesheet' type='text/css' href='SfApexDoc.css' /> <script>$(document).ready(function() {$('.toggle_container').hide();
$('h2.trigger').click(function() {
$(this).toggleClass('active').next().slideToggle('fast');ToggleBtnLabel(this.firstChild);return false; });});
function gotomenu(url) {document.location.href = url;}
function ToggleBtnLabel(ctrl) {ctrl.value = (ctrl.value=='+' ? '-' : '+');}
function IsExpanded(ctrl) {return (ctrl.value == '-');}
function ToggleAll(e) {var cExpanded = 0;$('h2.trigger', $(e).closest('tr')).each(function() {if (!IsExpanded(this.firstChild)) {$(this).toggleClass('active').next().slideToggle('fast');ToggleBtnLabel(this.firstChild);cExpanded++;}});if (cExpanded == 0) {$('h2.trigger', $(e).closest('tr')).each(function() {$(this).toggleClass('active').next().slideToggle('fast');ToggleBtnLabel(this.firstChild);});}}
</script></head><body><div class='topSection'><table><tr><td><img id='logo' src='logo.png'/></td><td><h2>Project Demo</h2>(specify an -author parameter to override this)<br/><a href='https://gitlab.com/StevenWCox/sfapexdoc/wikis/Home'>(GitLab project)</a><br/></td></tr></table></div><table width='100%'><tr><td class='leftmenus' rowspan='100'><div onclick="gotomenu('index.html');">Home</div><div onclick="gotomenu('csutils.html');">CSUtils</div><div onclick="gotomenu('dwaccounttriggerhandler.html');">DWAccountTriggerHandler</div><div onclick="gotomenu('dwcreateaccount.html');">DWCreateAccount</div><div onclick="gotomenu('dwcreateorder_controller.html');">DWCreateOrder_Controller</div><div onclick="gotomenu('dworderlist_controller.html');">DWOrderList_Controller</div><div onclick="gotomenu('dwsearchinstrument_controller.html');">DWSearchInstrument_Controller</div><div onclick="gotomenu('dwtriggerrecursivecheck.html');">DWTriggerRecursiveCheck</div><div onclick="gotomenu('drivewealth.html');">DriveWealth</div><div onclick="gotomenu('drivewealthapi.html');">DriveWealthAPI</div><div onclick="gotomenu('drivewealthjsonaccount.html');">DriveWealthJsonAccount</div><div onclick="gotomenu('drivewealthjsonaccount_test.html');">DriveWealthJsonAccount_Test</div><div onclick="gotomenu('drivewealthjsoninstrument.html');">DriveWealthJsonInstrument</div><div onclick="gotomenu('drivewealthjsonmarketorder.html');">DriveWealthJsonMarketOrder</div><div onclick="gotomenu('drivewealthjsonmarketorder_test.html');">DriveWealthJsonMarketOrder_Test</div><div onclick="gotomenu('drivewealthjsonorderstatus.html');">DriveWealthJsonOrderStatus</div><div onclick="gotomenu('drivewealthjsonorderstatus_test.html');">DriveWealthJsonOrderStatus_Test</div><div onclick="gotomenu('drivewealthjsonsession.html');">DriveWealthJsonSession</div><div onclick="gotomenu('etlc_apexbridge_abstract.html');">ETLC_ApexBridge_Abstract</div><div onclick="gotomenu('etlc_apexbridge_abstract_test.html');">ETLC_ApexBridge_Abstract_test</div><div onclick="gotomenu('etlc_apexbridge_clienttesthelper.html');">ETLC_ApexBridge_ClientTestHelper</div><div onclick="gotomenu('etlc_apexbridge_controller.html');">ETLC_ApexBridge_Controller</div><div onclick="gotomenu('etlc_apexbridge_controller_test.html');">ETLC_ApexBridge_Controller_Test</div><div onclick="gotomenu('etlc_apexbridge_data.html');">ETLC_ApexBridge_Data</div><div onclick="gotomenu('etlc_apexbridge_data_test.html');">ETLC_ApexBridge_Data_Test</div><div onclick="gotomenu('etlc_apexbridge_demoecho.html');">ETLC_ApexBridge_DemoEcho</div><div onclick="gotomenu('etlc_apexbridge_demoecho_test.html');">ETLC_ApexBridge_DemoEcho_Test</div><div onclick="gotomenu('etlc_exception.html');">ETLC_Exception</div><div onclick="gotomenu('httpmockresponse.html');">HTTPMockResponse</div><div onclick="gotomenu('httputilities.html');">HTTPUtilities</div><div onclick="gotomenu('sfdcaccesscontrolexception.html');">SFDCAccessControlException</div><div onclick="gotomenu('sfdcaccesscontroller.html');">SFDCAccessController</div><div onclick="gotomenu('util.html');">Util</div></td><td class='classCell'><h2 class='section-title'>DriveWealth<span><input type='button' value='+/- all' onclick='ToggleAll(this);' /></span></h2><div class='toggle_container_subtitle'>public with sharing class <a href='drivewealth.html'>DriveWealth</a></div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>DriveWealth class is wrapper fto DriveWealthAPI This class takes care of calling API methods, handling errors, dealing with database (for session) and more</td></tr><tr><th>Author</th><td>Jaswinder Rattanpal <jrattanpal@salesforce.com></td></tr></table><p></p><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>Properties</a></h2><div class='toggle_container'><table class='properties' border='1' rules='all' cellpadding='6'><tr><th class='clsPropertyName'>dws</th><td><div class='clsPropertyDeclaration'>public static DW_Session__C dws</div><div class='clsPropertyDescription'>Get DriveWealth session information from DW_Session__c object Name of a record for a session will show as "Account:DW_SESSION_KEY"</div></tr></table></div><h2 class='section-title methods'>Methods</h2><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>createMarketOrder</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonmarketorder.html'>DriveWealthJsonMarketOrder</a> createMarketOrder(Map&#60;<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a>, Object&#62; data)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Creating order needs information from multiple steps; http://developer.drivewealth.com/docs/add-market-order 1) Need to request Instrument information for stock; instrumentID 2) Present List of DW_Accounts and ask users to pick one (there should be only one as we are only creating Practice Accounts) --- Based on that selection, we can get accountID, accountNo, accountType, Account.userID 3) From user, we have to get ordType, side, orderQty Once we have this information, we can send it to DriveWealth</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>createPracticeAccount</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonaccount.html'>DriveWealthJsonAccount</a> createPracticeAccount(Map&#60;<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a>, Object&#62; data)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Create a Practice Account Ensure that init() is called before this to make sure there is valid session  <pre>
//Set this if you need to see debug statements
Util.debug = true;
//If there is no DW User ID" AND/OR "DW Account ID" associate with (standard) Account
//Then create new Practice account
//Hint: Use SOQL or initial data load to get this informaiton in, say, Lightning Component
String AccountID = '00141000007RP8w';
Account a = [select Id, AccountNumber, DW_Username__c, DW_Password__c, DW_Total_Practice_Accounts__c
from account
where id=:AccountId];
//If no DW Accounts then create one
if(a.DW_Total_Practice_Accounts__c <= 0 ){
//Custom setting to get "referralCode" needed to create account
DriveWealth__c dw = DriveWealth__c.getInstance() ;
String username = a.AccountNumber; //'sfusername';
String password = a.AccountNumber; //'sfpassword';
//Data for Practice Account Creation
Map<String, String> data = new Map<String, String> ();
data.put('emailAddress1', 'test@test.com2');//Pull from Account
data.put('firstName', 'FirstName 2');//Pull from Account
data.put('lastName', 'LastName 2');//Pull from Account
data.put('referralCode', dw.Referral_Code__c);
//If new account then provide username/password
data.put('username', username);
data.put('password', password);
System.debug(data);
//There is no setup because we want to use new username info for login
DriveWealthJsonAccount aInfo = DriveWealth.createPracticeAccount(data);
//Now login with new username/password to start session and get account info
DriveWealthJsonSession sessionInfo = DriveWealth.doSetup(a.Id, username, password);
//userID as returned after creating user
String DWUserID = aInfo.userID;
//Update account with new userID and username and password
a.DW_Username__c = username;
a.DW_Password__c = password;
a.DW_User_ID__c = sessionInfo.userID;
//Update account with new username, password and user I
update a;
//Go through entire list of accounts returned for that user and update the list
//This will return newly created account if user is new.
//But will also return account for old user
List<DW_Account__c> listAcc = new List<DW_Account__c>();
for(Integer i=0; i<sessionInfo.Accounts.size(); i++){
DW_Account__c acc = new DW_Account__c();
acc.name = sessionInfo.Accounts[i].nickname;
acc.Account__c = a.Id;
acc.Account_ID__c = sessionInfo.Accounts[i].accountID;
acc.Account_No__c = sessionInfo.Accounts[i].accountNo;
acc.Account_Type__c = sessionInfo.Accounts[i].accountType;
acc.Created_When__c = sessionInfo.Accounts[i].createdWhen;
acc.Opened_When__c = sessionInfo.Accounts[i].openedWhen;
listAcc.add(acc);
}
//Upsert all accounts using Account_ID__c as External key so that it's unique
upsert listAcc Account_ID__c;
System.debug(listAcc);
//Update new session Info from DriveWealth
DriveWealth.doCleanup();
}else{
}
List<DW_Account__c> listDWAcc = [select Account_ID__c, Account__r.Id,
Account__r.AccountNumber, Account__r.DW_User_ID__c
from DW_Account__c
where Account__r.Id=:AccountID];
//listDWAcc can be returned for use
System.debug(listDWAcc);
 </pre></td></tr><tr><th>Returns</th><td>DriveWealthJsonAccount</td></tr><tr><th colspan='2' class='paramHeader'>Parameters</th></tr><tr><th class='param'>UserID</th><td>If this is NOT empty then append it to API call to add </td></tr><tr><th class='param'>data</th><td>Map of data to be sent to DriveWealth for creating practice account </td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>decryptString</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>string</a> decryptString(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> stringToDecrypt)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Decrypt username/password</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>doCleanup</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static void doCleanup()</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>This is to update session information. But we need to do it AFTER the callouts otherwise we will get following error You have uncommitted work pending. Please commit or rollback before calling out</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>doSetup</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonsession.html'>DriveWealthJsonSession</a> doSetup(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> AccountID)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>This is used to prepare information for login. We need Account ID as we need to get DriveWealth username/password and other information This function will take care of preparing all that This method should be used before calling any function in this class. This will ensure that proper session is setup (only once) before proceeding</td></tr><tr><th>Returns</th><td>DriveWealthJsonSession</td></tr><tr><th colspan='2' class='paramHeader'>Parameters</th></tr><tr><th class='param'>AccountID</th><td>ID of Account to retrieve information </td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>doSetup</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonsession.html'>DriveWealthJsonSession</a> doSetup(Account a, <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>Boolean</a> useOrgWideCredentials)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Sometimes, like when searching symbols, we might want to use orgwide credentials rather than account credentials BUT, this will only happen if account credentials do not exist Otherise, continue to use account credentials</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>doSetup</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonsession.html'>DriveWealthJsonSession</a> doSetup(Account a)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Use Account credentials on it's own</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>doSetup</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonsession.html'>DriveWealthJsonSession</a> doSetup(Account a, <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a></a></a> DWUsername, <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a></a></a> DWPassword, <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a></a></a> DWUserID)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Same as doSetup but this one takes explicit username/password in case we need to supply it directly and not from Account If you already have account username (Etc) info then pass it. But if not then pass null and it will be queried</td></tr><tr><th colspan='2' class='paramHeader'>Parameters</th></tr><tr><th class='param'>AccountID</th><td>ID of Account to retrieve information </td></tr><tr><th class='param'>Username</th><td>DW Username to login </td></tr><tr><th class='param'>Password</th><td>DW Password to login </td></tr><tr><th class='param'>DWUserID</th><td>User ID for DriveWealth </td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>encryptString</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>string</a> encryptString(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> stringToEncrypt)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Encrypt username/password</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>getCryptoKey</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> getCryptoKey()</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Generate 32 letter crypto key for AES256</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>getOrderStatus</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonorderstatus.html'>DriveWealthJsonOrderStatus</a> getOrderStatus(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> OrderID)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Get Order status for an Order ID</td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>login</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static <a href='drivewealthjsonsession.html'>DriveWealthJsonSession</a> login(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a></a> username, <a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'><a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a></a> password)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Wrapper to login to DriveWealth First check if existing session is valid</td></tr><tr><th>Returns</th><td>DriveWealthJsonSession</td></tr><tr><th colspan='2' class='paramHeader'>Parameters</th></tr><tr><th class='param'>username</th><td>DW Username </td></tr><tr><th class='param'>password</th><td>DW Password </td></tr></table></div><h2 class='trigger'><input type='button' value='+'/>&nbsp;&nbsp;<a href='#'>searchInstrument</a></h2><div class='toggle_container'><div class='toggle_container_subtitle'>public static List&#60;<a href='drivewealthjsoninstrument.html'>DriveWealthJsonInstrument</a>&#62; searchInstrument(<a href='http://www.salesforce.com/us/developer/docs/apexcode/Content/langCon_apex_primitives.htm'>String</a> symbol)</div><table class='details' rules='all' border='1' cellpadding='6'><tr><th>Description</th><td>Search instrument, this is to get Stock Symbol information. This will later be used for orders Ensure that init() is called before this to make sure there is valid session  <pre>
Util.debug = true;
//Need to login to DriveWealth
//User "generic" username/password from Custom Settings
DriveWealth.doSetup('00141000007RP8r');
List<DriveWealthJsonInstrument> inInfo = DriveWealth.searchInstrument('CRM,AAPL');
//Update new session Info from DriveWealth
DriveWealth.doCleanup();
 </pre></td></tr><tr><th>Returns</th><td>DriveWealthJsonSession</td></tr><tr><th colspan='2' class='paramHeader'>Parameters</th></tr><tr><th class='param'>symbol</th><td>One or more (comma separated) symbols; CRM OR CRM,AAPL </td></tr></table></div></td></tr></table></div></div></td></tr></table><hr/><center id='footer'><a href='https://gitlab.com/StevenWCox/sfapexdoc/wikis/Home'>Powered By SfApexDoc version 1.2.5</a></center></body></html>